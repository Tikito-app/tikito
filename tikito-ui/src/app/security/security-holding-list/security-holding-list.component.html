<div class="main-side-column main-column" *ngIf="selectedHolding == null">
  <form [formGroup]="form" *ngIf="form">
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <mat-checkbox formControlName="showClosedPositions" (change)="onShowClosedPositionChanged($event)">{{ 'security/show-closed-positions' | translate }}
    </mat-checkbox>
  </form>
</div>
<div class="main-center-column main-column">

  <mat-tab-group>
    <mat-tab label="{{'security/holding/performance' | translate}}">
      <app-aggregated-security-holdings-graph
        [showTooltip]="true"
        [showLegend]="true"
        [height]="300"></app-aggregated-security-holdings-graph>
    </mat-tab>
    <mat-tab label="{{'security/sector' | translate}}">
      <app-trading-company-pie-graph [height]="300" [valueType]="'sector'"></app-trading-company-pie-graph>
    </mat-tab>
    <mat-tab label="{{'security/industry' | translate}}">
      <app-trading-company-pie-graph [height]="300" [valueType]="'industry'"></app-trading-company-pie-graph>
    </mat-tab>
    <mat-tab label="{{'currency' | translate}}">
      <app-trading-company-pie-graph [height]="300" [valueType]="'currency'"></app-trading-company-pie-graph>
    </mat-tab>
    <mat-tab label="{{'security/type' | translate}}">
      <app-trading-company-pie-graph [height]="300" [valueType]="'type'"></app-trading-company-pie-graph>
    </mat-tab>
  </mat-tab-group>


  <div class="mat-elevation-z8" *ngIf="dataSource">
    <table mat-table [dataSource]="dataSource">

      <ng-container matColumnDef="security-name">
        <th mat-header-cell *matHeaderCellDef>{{ 'security' | translate }}</th>
        <td mat-cell *matCellDef="let element"> {{ element.security.name }}</td>
      </ng-container>

      <ng-container matColumnDef="security-type">
        <th mat-header-cell *matHeaderCellDef>{{ 'security/type' | translate }}</th>
        <td mat-cell *matCellDef="let element"> {{ element.securityType }}</td>
      </ng-container>

      <ng-container matColumnDef="position-value">
        <th mat-header-cell *matHeaderCellDef>{{ 'security/holding/position-value' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <app-currency [amount]="SecurityUtil.getPositionValue(element)"
                        [currencyId]="element.currencyId"></app-currency>
        </td>
      </ng-container>

      <ng-container matColumnDef="isin">
        <th mat-header-cell *matHeaderCellDef>{{ 'security/isin' | translate }}</th>
        <td mat-cell *matCellDef="let element"> {{ element.currentIsin }}</td>
      </ng-container>

      <ng-container matColumnDef="profit-loss">
        <th mat-header-cell *matHeaderCellDef>{{ 'security/holding/profit-loss' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <app-currency [amount]="SecurityUtil.getTotalValue(element)" [currencyId]="element.currencyId"></app-currency>
        </td>
        <td mat-cell *matCellDef="let element"> {{ SecurityUtil.getTotalValue(element) }}</td>
      </ng-container>

      <ng-container matColumnDef="performance">
        <th mat-header-cell *matHeaderCellDef>{{ 'security/holding/performance' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="SecurityUtil.getPerformance(element) >= 0">
            <div style="color: green">
              <mat-icon>trending_up</mat-icon>
              {{ Util.percentageFormat(SecurityUtil.getPerformance(element)) }}
            </div>
          </ng-container>
          <ng-container *ngIf="SecurityUtil.getPerformance(element) < 0">
            <div style="color: red">
              <mat-icon>trending_down</mat-icon>
              {{ Util.percentageFormat(SecurityUtil.getPerformance(element)) }}
            </div>
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="options">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <button mat-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="onDeleteHolding(element)">
              <mat-icon>delete</mat-icon>
              <span>{{ 'delete' | translate }}</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (dblclick)="onRowDblClicked(row, $event)"
          (click)="onRowClicked(row, $event)" class="clickable"></tr>
    </table>

    <app-paginator></app-paginator>


  </div>
</div>
<div class="main-side-column main-column" *ngIf="selectedHolding != null">
  <app-security-holding-list-details [holding]="selectedHolding"
                                     (closeCallback)="selectedHolding = null"></app-security-holding-list-details>
</div>
